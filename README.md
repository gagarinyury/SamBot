# üé• SamBot v2 - YouTube Content Processor

> **–ü—Ä–µ–≤—Ä–∞—â–∞–π YouTube –≤–∏–¥–µ–æ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Å–ø–µ–∫—Ç—ã —Å AI**

–ë–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ —Ç—Ä–∞—Ç–∏—Ç—å —á–∞—Å—ã –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–ª–∏–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ. SamBot –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç—ã, —Å–æ–∑–¥–∞—ë—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ —Ä–µ–∑—é–º–µ —Å –ø–æ–º–æ—â—å—é AI –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é —á–µ—Ä–µ–∑ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫.

**üöÄ –ë—ã—Å—Ç—Ä–æ.** –°—É–±—Ç–∏—Ç—Ä—ã –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∑–∞ —Å–µ–∫—É–Ω–¥—ã. AI summary –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —Å streaming.

**üí∞ –î—ë—à–µ–≤–æ.** DeepSeek API —Å—Ç–æ–∏—Ç –∫–æ–ø–µ–π–∫–∏ (~$0.0003 –∑–∞ –≤–∏–¥–µ–æ). –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π Ollama –ª–æ–∫–∞–ª—å–Ω–æ.

**üéØ –ö–∞—á–µ—Å—Ç–≤–æ.** –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Å–ø–µ–∫—Ç—ã —Å emoji, markdown –∏ –∫–ª—é—á–µ–≤—ã–º–∏ –≤—ã–≤–æ–¥–∞–º–∏. RAG —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ç–æ—á–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã.

## üéØ –ß—Ç–æ —É–º–µ–µ—Ç (—Ä–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç)

- ‚úÖ **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞** –∏–∑ YouTube –≤–∏–¥–µ–æ (—Å—É–±—Ç–∏—Ç—Ä—ã + Whisper –¥–ª—è –∞—É–¥–∏–æ)
- ‚úÖ **AI —Ä–µ–∑—é–º–∏—Ä–æ–≤–∞–Ω–∏–µ** —á–µ—Ä–µ–∑ DeepSeek API –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π Ollama
- ‚úÖ **RAG (Retrieval-Augmented Generation)** - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –∏ Q&A –ø–æ –≤–∏–¥–µ–æ
- ‚úÖ **Streaming UI** - real-time –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ extraction –∏ summary
- ‚úÖ **Background processing** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ embeddings
- ‚úÖ **PostgreSQL + pgvector** - —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–æ–≤ –∏ –≤–µ–∫—Ç–æ—Ä–æ–≤

## üöß –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

- üîÑ **Telegram Bot** - –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- üîÑ **Web UI —É–ª—É—á—à–µ–Ω–∏—è** - —Ç–µ–∫—É—â–∏–π UI –±–∞–∑–æ–≤—ã–π, –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è —É–ª—É—á—à–µ–Ω–∏–µ

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Content        ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  PostgreSQL      ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ  RAG Service    ‚îÇ
‚îÇ  Extractor      ‚îÇ     ‚îÇ  + pgvector      ‚îÇ     ‚îÇ  (Semantic      ‚îÇ
‚îÇ  (YouTube API + ‚îÇ     ‚îÇ                  ‚îÇ     ‚îÇ   Search)       ‚îÇ
‚îÇ   Whisper)      ‚îÇ     ‚îÇ  ‚Ä¢ Transcripts   ‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ  ‚Ä¢ Chunks        ‚îÇ              ‚îÇ
                        ‚îÇ  ‚Ä¢ Embeddings    ‚îÇ              ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ  ‚Ä¢ Summaries     ‚îÇ              ‚îÇ
‚îÇ  Summarizer     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ                  ‚îÇ              ‚îÇ
‚îÇ  (DeepSeek/     ‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ
‚îÇ   Ollama)       ‚îÇ              ‚îÇ                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ                         ‚îÇ
        ‚îÇ                        ‚îÇ                         ‚îÇ
        ‚îÇ                        ‚ñº                         ‚îÇ
        ‚îÇ              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Web UI         ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ   (Streaming)    ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ
                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                       ‚îÇ  Telegram Bot    ‚îÇ
                       ‚îÇ  (Planned)       ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

**Backend:**
- Python 3.11 + FastAPI
- PostgreSQL 16 + pgvector (–≤–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î)
- Redis + RQ (—Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏)

**AI:**
- DeepSeek API (236B –º–æ–¥–µ–ª—å, streaming)
- Ollama (–ª–æ–∫–∞–ª—å–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞, qwen2.5:7b/14b/32b)
- nomic-embed-text (embeddings)

**Extraction:**
- yt-dlp (YouTube —Å—É–±—Ç–∏—Ç—Ä—ã)
- faster-whisper (—Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –∞—É–¥–∏–æ)
- YouTube Data API v3 (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker + Docker Compose
- 8+ GB RAM
- DeepSeek API key –∏–ª–∏ Ollama

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
git clone https://github.com/gagarinyury/SamBot.git
cd SamBot
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥
cp .env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env
nano .env
```

–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `.env`:

```bash
# Database
DB_PASSWORD=your_secure_password

# YouTube API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö)
YOUTUBE_API_KEY=your_youtube_api_key

# AI Provider: deepseek –∏–ª–∏ ollama
AI_PROVIDER=deepseek

# DeepSeek API (–µ—Å–ª–∏ AI_PROVIDER=deepseek)
DEEPSEEK_API_KEY=sk-your-deepseek-key

# Ollama –º–æ–¥–µ–ª—å (–µ—Å–ª–∏ AI_PROVIDER=ollama)
SUMMARIZER_MODEL=qwen2.5:7b-instruct-q4_K_M
```

### 3. –î–ª—è Ollama (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ DeepSeek)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Ollama
brew install ollama  # macOS
# –∏–ª–∏ —Å–∫–∞—á–∞—Ç—å —Å https://ollama.com

# –ó–∞–ø—É—Å—Ç–∏—Ç—å Ollama
ollama serve

# –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª–∏
ollama pull qwen2.5:7b-instruct-q4_K_M  # 5GB RAM
ollama pull nomic-embed-text            # embeddings
```

### 4. –ó–∞–ø—É—Å–∫

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker compose up -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker compose ps

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker compose logs -f
```

### 5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–û—Ç–∫—Ä—ã—Ç—å Web UI: http://localhost:8080

1. –í—Å—Ç–∞–≤–∏—Ç—å YouTube URL
2. –ù–∞–∂–∞—Ç—å "Extract Content"
3. –î–æ–∂–¥–∞—Ç—å—Å—è extraction (1-2 –º–∏–Ω –¥–ª—è –∞—É–¥–∏–æ, 5-10 —Å–µ–∫ –¥–ª—è —Å—É–±—Ç–∏—Ç—Ä–æ–≤)
4. –ù–∞–∂–∞—Ç—å "Create Summary" –¥–ª—è —Ä–µ–∑—é–º–∏—Ä–æ–≤–∞–Ω–∏—è
5. –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –≤ RAG Q&A —Å–µ–∫—Ü–∏–∏

## üì¶ –°–µ—Ä–≤–∏—Å—ã

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------|----------|
| **web_ui** | 8080 | Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (streaming) |
| **content_extractor** | 8001 | Extraction YouTube –∫–æ–Ω—Ç–µ–Ω—Ç–∞ |
| **summarizer** | 8002 | AI —Ä–µ–∑—é–º–∏—Ä–æ–≤–∞–Ω–∏–µ (DeepSeek/Ollama) |
| **rag_service** | 8003 | –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ + Q&A |
| **postgres** | 5432 | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö + pgvector |
| **redis** | 6379 | –û—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á |
| **worker** | - | Background processor (embeddings) |

## üé® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. Content Extraction

**–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è:**
1. YouTube —Å—É–±—Ç–∏—Ç—Ä—ã (–±—ã—Å—Ç—Ä–æ, ~5 —Å–µ–∫)
2. Whisper transcription (–º–µ–¥–ª–µ–Ω–Ω–æ, 1-2 –º–∏–Ω, –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ)

**–ß—Ç–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è:**
- –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç (—á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç, –±–µ–∑ WEBVTT –º—É—Å–æ—Ä–∞)
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –∫–∞–Ω–∞–ª, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –æ–ø–∏—Å–∞–Ω–∏–µ)
- –ì–ª–∞–≤—ã –≤–∏–¥–µ–æ (–µ—Å–ª–∏ –µ—Å—Ç—å –≤ –æ–ø–∏—Å–∞–Ω–∏–∏)

### 2. AI Summarization

**–î–≤–∞ —Ä–µ–∂–∏–º–∞:**

**A) DeepSeek API (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
- ‚úÖ –ë—ã—Å—Ç—Ä–æ (~2-5 —Å–µ–∫ start, streaming)
- ‚úÖ –¢–æ–ø –∫–∞—á–µ—Å—Ç–≤–æ (236B –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
- ‚úÖ –î—ë—à–µ–≤–æ (~$0.0001-0.0003 –∑–∞ summary)
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (emoji, markdown)

**B) Ollama (–ª–æ–∫–∞–ª—å–Ω–æ):**
- ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
- ‚úÖ –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å
- ‚ö†Ô∏è –ú–µ–¥–ª–µ–Ω–Ω–µ–µ (30-60 —Å–µ–∫ –¥–ª—è 7B –º–æ–¥–µ–ª–∏)
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç RAM (5GB –¥–ª—è 7B, 9GB –¥–ª—è 14B, 20GB –¥–ª—è 32B)

**–§–æ—Ä–º–∞—Ç summary:**
```markdown
## üéØ –ì–õ–ê–í–ù–ê–Ø –¢–ï–ú–ê
[–û–¥–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ]

## üìã –ö–†–ê–¢–ö–ò–ô –û–ë–ó–û–†
[2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è]

## üîë –û–°–ù–û–í–ù–´–ï –†–ê–ó–î–ï–õ–´
### 1. [–†–∞–∑–¥–µ–ª]
- **–ö–ª—é—á–µ–≤–∞—è –º—ã—Å–ª—å**: ...
- **–î–µ—Ç–∞–ª–∏**: ...
- **–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ**: ...

## üí° –ö–õ–Æ–ß–ï–í–´–ï –í–´–í–û–î–´
1. ...
2. ...

## üìä –í–ê–ñ–ù–´–ï –§–ê–ö–¢–´ –ò –¶–ò–§–†–´
- ...
```

### 3. RAG (Semantic Search + Q&A)

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —á–∞–Ω–∫–∏ (~500 —Ç–æ–∫–µ–Ω–æ–≤)
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è embedding (768-–º–µ—Ä–Ω—ã–π –≤–µ–∫—Ç–æ—Ä)
3. –ü—Ä–∏ –≤–æ–ø—Ä–æ—Å–µ ‚Äî –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —á–∞–Ω–∫–æ–≤ —á–µ—Ä–µ–∑ pgvector
4. LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `SIMILARITY_THRESHOLD`: 0.5 (cosine similarity)
- `TOP_K_RESULTS`: 3 (–∫–æ–ª-–≤–æ —á–∞–Ω–∫–æ–≤ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
- `content_id` —Ñ–∏–ª—å—Ç—Ä: –ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –≤–∏–¥–µ–æ

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

```bash
# –ù–∞ DeepSeek
echo "AI_PROVIDER=deepseek" >> .env
docker compose restart summarizer rag_service

# –ù–∞ Ollama
echo "AI_PROVIDER=ollama" >> .env
docker compose restart summarizer rag_service
```

### –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ Ollama

```bash
# –°–∫–∞—á–∞—Ç—å –º–æ–¥–µ–ª—å
ollama pull qwen2.5:14b  # 9GB RAM, –ª—É—á—à–µ –∫–∞—á–µ—Å—Ç–≤–æ

# –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥
echo "SUMMARIZER_MODEL=qwen2.5:14b" >> .env
docker compose restart summarizer
```

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏:**
- `qwen2.5:3b` (~2GB RAM, –±–∞–∑–æ–≤–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ)
- `qwen2.5:7b` (~5GB RAM, —Ö–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ) ‚≠ê —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è
- `qwen2.5:14b` (~9GB RAM, –æ—Ç–ª–∏—á–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ)
- `qwen2.5:32b` (~20GB RAM, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ)

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤

–ü—Ä–æ–º–ø—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –∫–æ–¥–µ:
- **Summarizer**: `services/summarizer/summarizer.py` (SYSTEM_PROMPT)
- **RAG**: `services/rag_service/rag_engine.py` (RAG_SYSTEM_PROMPT)

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
```bash
docker compose up -d --build summarizer  # –∏–ª–∏ rag_service
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Extraction –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker compose logs content_extractor

# –ß–∞—Å—Ç—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
# - YouTube –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª IP ‚Üí –¥–æ–±–∞–≤–∏—Ç—å cookies.txt
# - –ù–µ—Ç —Å—É–±—Ç–∏—Ç—Ä–æ–≤ ‚Üí –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω Whisper (–º–µ–¥–ª–µ–Ω–Ω–æ)
# - YouTube API key –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ yt-dlp
```

### Summary –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä
docker compose logs summarizer

# DeepSeek:
# - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API key –≤ .env
# - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç—ã –Ω–∞ platform.deepseek.com

# Ollama:
# - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Ollama –∑–∞–ø—É—â–µ–Ω: ollama list
# - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞
```

### RAG –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å embeddings
docker compose exec postgres psql -U sambot -d sambot_v2 \
  -c "SELECT COUNT(*) FROM content_embeddings;"

# –ï—Å–ª–∏ embeddings = 0:
# - Worker –Ω–µ —Å–æ–∑–¥–∞–ª embeddings
# - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: docker compose logs worker
```

### Streaming –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "Generating..." –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ summarizer
docker compose logs summarizer --tail 50

# –ß–∞—Å—Ç—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
# - DeepSeek API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
# - Ollama –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
# - –ü—Ä–µ–≤—ã—à–µ–Ω timeout (90 —Å–µ–∫)

# –†–µ—à–µ–Ω–∏–µ: –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
sambot-v2/
‚îú‚îÄ‚îÄ docker-compose.yml              # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
‚îú‚îÄ‚îÄ .env                            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–Ω–µ –≤ git)
‚îú‚îÄ‚îÄ .env.example                    # –®–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ README.md                       # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ migrations/                     # SQL –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ 01_init_schema.sql         # –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
‚îÇ   ‚îî‚îÄ‚îÄ 02_rag_tables.sql          # –¢–∞–±–ª–∏—Ü—ã –¥–ª—è RAG
‚îÇ
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ content_extractor/         # YouTube extraction
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py               # FastAPI app
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ extractor.py          # –õ–æ–≥–∏–∫–∞ extraction
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config.py             # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ summarizer/                # AI summarization
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py               # FastAPI app
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ summarizer.py         # –õ–æ–≥–∏–∫–∞ summary
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deepseek_client.py    # DeepSeek API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ollama_client.py      # Ollama API
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ rag_service/               # Semantic search + Q&A
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py               # FastAPI app
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rag_engine.py         # RAG –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.py           # Vector search
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ web_ui/                    # Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app_streaming.py      # Flask app (SSE)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ templates/            # HTML templates
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ worker/                    # Background tasks
‚îÇ       ‚îú‚îÄ‚îÄ worker.py             # RQ worker
‚îÇ       ‚îî‚îÄ‚îÄ tasks.py              # Task definitions
‚îÇ
‚îî‚îÄ‚îÄ scripts/                       # –£—Ç–∏–ª–∏—Ç—ã
    ‚îî‚îÄ‚îÄ migrate_from_sqlite.py    # –ú–∏–≥—Ä–∞—Ü–∏—è –∏–∑ v1
```

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–¢–∞–±–ª–∏—Ü—ã:**
- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `original_content` - —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç—ã –≤–∏–¥–µ–æ
- `content_chunks` - —Ä–∞–∑–±–∏—Ç—ã–µ —á–∞–Ω–∫–∏ –¥–ª—è RAG
- `content_embeddings` - –≤–µ–∫—Ç–æ—Ä—ã (pgvector)
- `summaries_cache` - –∫—ç—à —Ä–µ–∑—é–º–µ

**–ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:**

```sql
-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
SELECT COUNT(*) FROM original_content;
SELECT COUNT(*) FROM content_embeddings;

-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤–∏–¥–µ–æ
SELECT id, original_url, LENGTH(raw_content)
FROM original_content
ORDER BY created_at DESC
LIMIT 5;

-- Semantic search (–ø—Ä–∏–º–µ—Ä)
SELECT chunk_text,
       1 - (embedding <=> '[0.1,0.2,...]'::vector) as similarity
FROM content_embeddings ce
JOIN content_chunks cc ON ce.chunk_id = cc.id
WHERE 1 - (embedding <=> '[0.1,0.2,...]'::vector) >= 0.5
ORDER BY embedding <=> '[0.1,0.2,...]'::vector
LIMIT 5;
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ß—Ç–æ –ù–ï –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ git:**
- `.env` - —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–∞—Ä–æ–ª–∏ –∏ API –∫–ª—é—á–∏
- `cookies.txt` - YouTube cookies (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)
- `audio_storage/` - —Å–∫–∞—á–∞–Ω–Ω—ã–µ –∞—É–¥–∏–æ —Ñ–∞–π–ª—ã
- `__pycache__/` - Python –∫—ç—à

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–π —Å–∏–ª—å–Ω—ã–π `DB_PASSWORD`
- DeepSeek API key –¥–µ—Ä–∂–∏ –≤ —Å–µ–∫—Ä–µ—Ç–µ
- YouTube API key –∏–º–µ–µ—Ç –∫–≤–æ—Ç—ã ‚Äî –Ω–µ –ø—É–±–ª–∏–∫—É–π

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–¢–∏–ø–∏—á–Ω–æ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏:**

| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|----------|-------|------------|
| Extraction (subtitles) | 5-10 —Å–µ–∫ | –ë—ã—Å—Ç—Ä–æ |
| Extraction (Whisper) | 1-2 –º–∏–Ω | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏–Ω—ã –≤–∏–¥–µ–æ |
| Embeddings creation | 10-30 —Å–µ–∫ | Background, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| Summary (DeepSeek) | 5-15 —Å–µ–∫ | Streaming, –≤–∏–¥–∏—à—å –ø—Ä–æ–≥—Ä–µ—Å—Å |
| Summary (Ollama 7B) | 30-60 —Å–µ–∫ | –õ–æ–∫–∞–ª—å–Ω–æ, –º–µ–¥–ª–µ–Ω–Ω–µ–µ |
| RAG Q&A | 2-5 —Å–µ–∫ | –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ + LLM |

**–°—Ç–æ–∏–º–æ—Å—Ç—å (DeepSeek):**
- Summary: ~$0.0001-0.0003 –∑–∞ –≤–∏–¥–µ–æ
- RAG Q&A: ~$0.00005 –∑–∞ –≤–æ–ø—Ä–æ—Å
- 1000 –≤–∏–¥–µ–æ ‚âà $0.20-0.30

## üöÄ –î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ

**–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ:**
1. **Telegram Bot** - –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
2. **–£–ª—É—á—à–µ–Ω–Ω—ã–π Web UI** - –±–æ–ª–µ–µ –∫—Ä–∞—Å–∏–≤—ã–π –∏ —É–¥–æ–±–Ω—ã–π
3. **Batch processing** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–∏–¥–µ–æ
4. **Export** - Notion, Obsidian, Markdown
5. **Multi-language support** - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ —Ä—É—Å—Å–∫–æ–º/–∞–Ω–≥–ª–∏–π—Å–∫–æ–º

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [DeepSeek Platform](https://platform.deepseek.com)
- [Ollama](https://ollama.com)
- [pgvector](https://github.com/pgvector/pgvector)
- [FastAPI](https://fastapi.tiangolo.com)
- [yt-dlp](https://github.com/yt-dlp/yt-dlp)

## ü§ù Contributing

–ü—Ä–æ–µ–∫—Ç –≤ –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. Pull requests –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è!

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç (–æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏—á–∏)
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 1 –æ–∫—Ç—è–±—Ä—è 2025
